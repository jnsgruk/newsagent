# Newsagent

> This project was my first experimentation with developing a custom agent. Much of the code
> was generated by the Gemini 3 Pro model through GitHub Copilot. It's been genuinely useful
> to me, but is unlikely to be very useful to you unless you have the exact problem I do!
>
> I've posted this in case it's useful for someone else's learning.

In my role at Canonical, I like to write a newsletter for each department I'm leading that covers
the things I'm thinking about, shouts out new starters, highlights achievements, and generally
disseminates updates that might be interesting across the org.

The last section of the newsletter is a summary of new releases from the past month - I create this
by dumping links in a Todoist list throughout the month when I see new releases on GitHub or
Discourse, and at the end of the month I run through the list and write a short paragraph about each.

This "Tech Updates" section is quite formulaic, and this project represents my first attempt at
"agent development" to help me get to a first draft of the "Tech Updates" section. It uses
Gemini as an LLM backend. The flow is as follows:

- Create an agent with a [system prompt](./src/agent/prompt.rs) describing the problem
- Use the [glean tool](./src/tools/glean.rs) to gather existing drafts on my filesystem as context
- Use the [todoist tool](./src/tools/todoist.rs) to get the list of tasks for this month
- Use the [web tool](./src/tools/web.rs) to browse to the links to understand the release

Once this is done, the agent instructs the LLM to generate the "Tech Updates" section.

## Configuration

Newsagent is configured via environment variables. You can set these in your shell or use a `.env` file in the project root.

### Required Variables

| Variable                       | Description                                                           |
| :----------------------------- | :-------------------------------------------------------------------- |
| `NEWSAGENT_GEMINI_API_KEY`     | Your Google Gemini API Key.                                           |
| `NEWSAGENT_TODOIST_API_TOKEN`  | API Token for Todoist.                                                |
| `NEWSAGENT_TODOIST_PROJECT_ID` | The ID of the Todoist project containing your newsletter items.       |
| `NEWSAGENT_GLEAN_DIR`          | Directory path containing markdown files to be used as style context. |

### Optional Variables

| Variable                            | Description                                           | Default                   |
| :---------------------------------- | :---------------------------------------------------- | :------------------------ |
| `NEWSAGENT_GEMINI_MODEL`            | The Gemini model to use.                              | `gemini-3-pro-preview`    |
| `NEWSAGENT_TODOIST_PROJECT_SECTION` | Specific section ID within the Todoist project.       |                           |
| `NEWSAGENT_TODOIST_BASE_URL`        | Base URL for the Todoist API.                         | `https://api.todoist.com` |
| `NEWSAGENT_GLEAN_FILTER`            | Glob pattern to filter files in the glean directory.  |                           |
| `NEWSAGENT_WEB_ALLOWLIST`           | Comma-separated list of allowed domains for scraping. | (All allowed)             |
| `NEWSAGENT_WEB_MAX_CHARS`           | Maximum number of characters to read from a webpage.  |                           |
| `NEWSAGENT_WEB_TIMEOUT_SECS`        | Timeout for web requests in seconds.                  |                           |
| `NEWSAGENT_DOTENV_PATH`             | Custom path to the `.env` file.                       | `.env`                    |

## Setup & Usage

1.  **Install Dependencies**: Ensure you have [Rust](https://www.rust-lang.org/) installed.
2.  **Configure Environment**: Create a `.env` file with the necessary variables.
    ```bash
    NEWSAGENT_GEMINI_API_KEY=your_key_here
    NEWSAGENT_TODOIST_API_TOKEN=your_token_here
    NEWSAGENT_TODOIST_PROJECT_ID=123456789
    NEWSAGENT_GLEAN_DIR=/path/to/archive
    ```
3.  **Run**:
    ```bash
    cargo run
    ```

The generated newsletter content will be printed to stdout.
